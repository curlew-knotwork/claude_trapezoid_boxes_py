# trapezoid_boxes — Failure Report

| Timestamp (UTC) | Δ prev | Iterations to fix | Failure | Detail |
|---|---|---|---|---|
| 2026-02-26T18:21:39Z | — | 2 sessions, ~11h | SVG visual inspection skipped — hanging tab | 06c_full_base.svg contained a hanging tab (finger overshot arc tangent point by 14.6mm) present since session 12; survived 9 declarations of spec correctness, 2 days, 15 sessions, and external Gemini audit; found only when user opened the file — arithmetic proof passing was treated as equivalent to output correctness, which it is not |
| 2026-02-27T01:28:21Z | +7h 6m | 6 SVG generations, ~25m | SVG visual inspection skipped — trapezoid corner angles inverted | Soundhole rounded-trapezoid corners had obtuse/acute assignment exactly backwards; narrow-end = obtuse (90+leg_angle), wide-end = acute (90−leg_angle) — same rule as body panel, never verified from geometry. Produced blobs/bumps, caught only by user each time. Same root cause as hanging tab: output presented without verifying geometry. Fix: invariant in spec §8, proofs 05+06, claude.md. |
| 2026-02-28T~10:00Z | +~32h | 1 visual + 2 code fixes, ~30m | Wrong panel set in test cut | Test cut included 2× WALL_LONG (should be 1), standalone soundhole piece (no purpose), and walls had no wall-to-wall finger joints. Caught by user on first review. Root cause: did not reason about box assembly before generating panels. |
| 2026-02-28T~10:30Z | +~30m | 1 iteration | Spurious protrusion on wall top/bottom corners | Wall top edges showed a horizontal step at each end equal to one tab width. Root cause: finger perpendicular direction derived from travel direction — unreliable for vertical edges. Upward travel (0,−1) gives perp (1,0)=rightward=interior, not exterior. Fix: pass explicit d_out vector to all fingers() calls. |
| 2026-02-28T~11:00Z | +~30m | 1 cut + 1 code fix | Burn model wrong — floppy joints, fingers not engaging slots | Physical test cut: joints loose (flopped), wall-to-wall fingers not engaging slots. Root cause (1): burn not applied to tab/gap widths at all — only to depth. Correct model: drawn_tab=fw+2×burn (wider), drawn_slot=fw−2×burn+2×tol (narrower), nominal_fit=−4×burn+2×tol. Root cause (2) discovered next session: initial "fix" set burn=0.1, tol=0.1, claimed fit=−0.2mm but double-counted kerf — physical fit was actually 0.0mm (hand press, not friction). Correct defaults: burn=0.05, tol=0.0 → fit=−0.2mm (matches boxes.py). |
| 2026-02-28T~12:00Z | +~1h | 1 analysis pass | Burn model re-derived incorrectly — defaults wrong after "fix" | First attempted fix set burn=0.1, tol=0.1 claiming nominal fit=−0.2mm interference. Error: formula is correct but this double-counts laser kerf. Physical fit = (drawn_slot + 2×burn_actual) − (drawn_tab − 2×burn_actual) = nominal_fit + 4×burn_actual. With burn_actual≈0.05, physical fit = −0.2+0.2 = 0.0mm — hand press not friction. Additionally, spec constants DEFAULT_BURN and DEFAULT_TOLERANCE were updated to 0.1 in the "fix" session but never propagated to gen_test_cut.py in the repo (only written to /home/claude/). Multiple documents became inconsistent. Fix: burn=0.05, tol=0.0 everywhere; repo gen_test_cut.py copied from /home/claude/; claude.md, spec, proofs all corrected in one pass. |
| 2026-02-28T~14:00Z | +~2h | code analysis (no physical cut) | Burn model fix not propagated to core/joints.py | core/joints.py finger_edge_to_path_segments() used tab_width=fw−tol, gap_width=fw+tol — the "clearance not interference" model explicitly wrong per claude.md. gen_test_cut.py was fixed in the previous session but the production code path (box/panels.py → core/joints.py) was never updated. All box and instrument mode SVG still produce floppy joints. Root cause: proof 03 tests the burn model in isolation (correct) but does not import or exercise core/joints.py. Fix: core/joints.py lines 163-164 corrected to tab=fw+2×burn, gap=fw−2×burn+2×tol. |
| 2026-02-28T~14:00Z | +0 | code analysis (no physical cut) | gen_test_cut.py slot uses tab_w instead of gap_w | fingers() with is_slot=True used tab_w (fw+2×burn) for slot features (i%2==0). Docstring said "drawn_gap width" and spec §10.5 requires drawn_slot=fw−2×burn+2×tol. nominal_fit printout (gap_w−tab_w=−0.2mm) was correct but did not reflect the actual SVG: slots were drawn at tab_w, not gap_w. Root cause: burn model formulas were corrected in the previous session but the tab/gap swap for is_slot=True was not applied. Fix: even features use gap_w when is_slot=True, odd features use tab_w (matching the swap logic already present in core/joints.py). |
| 2026-02-28T~14:00Z | +0 | code analysis | CommonConfig.tolerance default mismatch | core/models.py CommonConfig.tolerance=0.1 but DEFAULT_TOLERANCE_MM=0.0 in spec constants and "tol=0.0 everywhere" per entry above. Production code defaulted to hand-press (0mm nominal fit) instead of rubber mallet (−0.2mm). Fix: CommonConfig.tolerance changed to 0.0; spec, CLI help, and reference values updated. Note: sliding-lid users must pass --tolerance 0.1 since groove angle validation requires tol>0. |
| 2026-02-28T~15:00Z | +~1h | code analysis (no physical cut) | WALL_LONG width regression in gen_test_cut.py | build_wall() called with length_o=45mm instead of long_o=65mm. Alignment proof: bot_margin=(w−n_long×fw_long)/2 must equal tang_s (BASE wide-end corner tangent offset) for finger zones to coincide. With w=45mm: bot_margin=1.22mm ≠ tang_s=11.22mm → 10mm misalignment. With w=65mm: bot_margin=11.22mm = tang_s → 0mm misalignment. Label and bbox entry also used length_o. Fix was originally in commit 43ca2a4 but reverted by 416ccf9 ("copy from /home/claude/"). Caught only during post-session correctness audit; verify-or-abort does not check finger zone alignment. Fix: three length_o references changed to long_o; SVG regenerated (311.2×77.0mm). |
| 2026-02-28T22:10Z | +~7h | code analysis (no physical cut) | Slotted edge condition inverted in core/joints.py | `finger_edge_to_path_segments()` had `elif not is_tab and edge.is_slotted:` — meaning the branch that widens tab features for slotted edges was skipped when is_tab=True (the only case it should apply). Tabs at EVEN positions were drawn at tab_w; when is_slotted=True they should still be tab_w but now no override happened. Slots appeared at ODD positions instead of EVEN on slotted edges, misaligned with mating panels' tabs. Root cause: double-negation in a derived condition. Fix: `elif not is_tab` → `elif is_tab`; single-line change. Caught by proofs and verify-or-abort; not found during burn model session because slotted path was not exercised in isolation. |
| 2026-03-01T02:28Z | +~4h | code analysis | extract_config() returned None — SVG namespace not qualified | `root.find("metadata")` returned None for every SVG produced by the generator. ElementTree qualifies all elements with their xmlns namespace; the SVG `<metadata>` element is stored as `{http://www.w3.org/2000/svg}metadata`. An unqualified `find("metadata")` never matches. Feature was silently broken from the start — `--extract-config` always raised `AttributeError: 'NoneType' object has no attribute 'text'`. Fix: added `"svg": "http://www.w3.org/2000/svg"` to namespace dict and changed `root.find("metadata")` to `root.find("svg:metadata", ns)`. |
| 2026-03-01T~05:00Z | +~3h | code analysis + validation added | Wall-to-wall finger zone silent plain-edge failure | When `depth_outer − 2×corner_radius < thickness + 2×burn`, `make_finger_edge()` returns count=0 (plain edge) with only a `warnings.warn`. No finger joints are generated for wall-to-wall connections; the box is structurally unassembleable. With default R=3×T=9mm and depth_outer=20mm: available=20−18=2mm vs needed=3.1mm → all four wall-to-wall edges become plain lines. User reported "finger joints too short to reach mating divot" on a small test box; visual inspection confirmed no finger engagement. Root cause: `make_finger_edge()` degrades gracefully for layout reasons but this is never acceptable for assembly joints; no validation existed to catch it. Fix: validation check added to `validate_config()` in both `box/cli.py` and `instrument/cli.py`; emits `VALIDATION_FINGER_TOO_THIN` with maximum allowed corner radius and exits before generating SVG. |

