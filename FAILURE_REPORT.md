# trapezoid_box — Failure Report

| Timestamp (UTC) | Δ prev | Iterations to fix | Failure | Detail |
|---|---|---|---|---|
| 2026-02-26T18:21:39Z | — | 2 sessions, ~11h | SVG visual inspection skipped — hanging tab | 06c_full_base.svg contained a hanging tab (finger overshot arc tangent point by 14.6mm) present since session 12; survived 9 declarations of spec correctness, 2 days, 15 sessions, and external Gemini audit; found only when user opened the file — arithmetic proof passing was treated as equivalent to output correctness, which it is not |
| 2026-02-27T01:28:21Z | +7h 6m | 6 SVG generations, ~25m | SVG visual inspection skipped — trapezoid corner angles inverted | Soundhole rounded-trapezoid corners had obtuse/acute assignment exactly backwards; narrow-end = obtuse (90+leg_angle), wide-end = acute (90−leg_angle) — same rule as body panel, never verified from geometry. Produced blobs/bumps, caught only by user each time. Same root cause as hanging tab: output presented without verifying geometry. Fix: invariant in spec §8, proofs 05+06, claude.md. |
| 2026-02-27T15:00:00Z | +13h 32m | 1 session, ~2h | Example SVGs invisible — hairline stroke not distinguished from display stroke | SVG_HAIRLINE_MM = 0.001 renders sub-pixel at any normal screen zoom; examples showed only floating text and grain arrows over white space. Laser hairline is correct for production but examples are for human consumption. Root cause: spec specified hairline constant but never specified that examples require a separate display stroke. Fix: display_stroke_mm added to CommonConfig; --display-stroke MM CLI flag on both modes; examples regenerated at 0.3mm. |
| 2026-02-27T15:00:00Z | 0m | 1 session, ~1h | Layout rotation — metadata-only swap, path coordinates not transformed | core/layout.py rotated panels by swapping Panel.width/height only; outline ClosedPath coordinates were not transformed. A 381mm-wide leg wall "rotated" to 90mm in layout metadata but rendered 381mm wide, overflowing the sheet. User saw clipped/invisible second wall. Root cause: spec described NFDH rotation but never stated the invariant "rotating a panel requires physically transforming all path coordinates." Fix: rotate_panel_90cw() in transform.py applies (x,y)→(y,w−x) to all outline/hole/score/mark coordinates; layout calls it instead of dataclasses.replace. |
| 2026-02-27T15:00:00Z | 0m | 1 session | WALL_LEG_RIGHT inherited wrong label from dataclasses.replace | instrument/panels.py built leg_right = dataclasses.replace(leg_left, name="WALL_LEG_RIGHT") but the marks list was shared from leg_left, containing Mark(content="WALL_LEG_LEFT"). Panel rendered with wrong label. Fix: replace LABEL mark content when constructing leg_right. |
| 2026-02-27T16:00:00Z | +1h | 1 session | Rotated panel labels horizontal — rotate_panel_90cw incremented grain_angle_deg but not mark.angle_deg | When layout rotated a panel 90°, mark positions were correctly transformed but mark.angle_deg was not incremented. All labels stayed horizontal regardless of panel orientation, overlapping and illegible on rotated panels. Fix: increment mark.angle_deg by 90 in rotate_panel_90cw; apply transform="rotate(...)" in svg_writer for LABEL and ASSEMBLY_NUM marks. |
| 2026-02-27T16:00:00Z | 0m | 1 session | F-hole rendered as two small circles — segs list built then discarded | _make_fhole_shape built a full segs list then replaced it with ClosedPath of only the two upper-eye arcs. User saw two small circles per f-hole. Root cause: code was clearly incomplete (segs variable unused) but no output was verified. Fix: rewrote _make_fhole_shape with correct 5-segment path (A L A L A): CW arc top→right-junction of upper eye, line down right shaft, large CW arc around lower eye, line up left shaft, CW arc left-junction→top of upper eye. |
| 2026-02-27T16:00:00Z | 0m | 1 session | Rounded-trapezoid soundhole corners inverted (biscuits) — CCW arcs at corners | _build_rtrap_path used Arc(..., False, False) — CCW arcs — at all corners of the hole outline (CW traversal). For CW traversal, CCW corner arcs have their center at the corner vertex (outside the hole), causing arcs to bow away from the corner into the hole — visible as biscuit bumps. Fix: Arc(..., False, True) — CW arcs — center inside the hole, arcs bow toward the corner vertex, correctly removing material at corners. Verified analytically: CCW small arc from (8,0) to (10,2) r=2 → center (10,0) = corner vertex = biscuit; CW small arc → center (8,2) = inside hole = correct rounding. |
